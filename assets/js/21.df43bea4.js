(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{608:function(e,t,r){e.exports=r.p+"assets/img/deploy-multi-service-app-2.6d2de4f2.png"},609:function(e,t,r){e.exports=r.p+"assets/img/deploy-multi-service-app-4.558f2d9a.png"},696:function(e,t,r){"use strict";r.r(t);var a=r(16),s=Object(a.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"_3-7-部署应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-7-部署应用"}},[e._v("#")]),e._v(" 3.7 部署应用")]),e._v(" "),a("h2",{attrs:{id:"_1-先决条件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-先决条件"}},[e._v("#")]),e._v(" 1. 先决条件")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://docs.docker-cn.com/engine/installation/",target:"_blank",rel:"noopener noreferrer"}},[e._v("安装 Docker 版本 1.13 或更高版本"),a("OutboundLink")],1),e._v("。")]),e._v(" "),a("li",[e._v("按照"),a("a",{attrs:{href:"https://docs.docker-cn.com/get-started/part3/#prerequisites",target:"_blank",rel:"noopener noreferrer"}},[e._v("第 3 部分：先决条件"),a("OutboundLink")],1),e._v("中所述，获取 "),a("a",{attrs:{href:"https://docs.docker-cn.com/compose/overview/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker Compose"),a("OutboundLink")],1),e._v("。")]),e._v(" "),a("li",[e._v("按照"),a("a",{attrs:{href:"https://docs.docker-cn.com/get-started/part4/#prerequisites",target:"_blank",rel:"noopener noreferrer"}},[e._v("第 4 部分：先决条件"),a("OutboundLink")],1),e._v("中所述，获取 "),a("a",{attrs:{href:"https://docs.docker-cn.com/machine/overview/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker Machine"),a("OutboundLink")],1),e._v("。")]),e._v(" "),a("li",[e._v("阅读"),a("a",{attrs:{href:"https://docs.docker-cn.com/get-started/",target:"_blank",rel:"noopener noreferrer"}},[e._v("第 1 部分"),a("OutboundLink")],1),e._v("中的新用户导引。")]),e._v(" "),a("li",[e._v("在"),a("a",{attrs:{href:"https://docs.docker-cn.com/get-started/part2/",target:"_blank",rel:"noopener noreferrer"}},[e._v("第 2 部分"),a("OutboundLink")],1),e._v("中了解如何创建容器。")]),e._v(" "),a("li",[e._v("确保您已发布通过"),a("a",{attrs:{href:"https://docs.docker-cn.com/get-started/part2/#share-your-image",target:"_blank",rel:"noopener noreferrer"}},[e._v("将其推送到镜像库"),a("OutboundLink")],1),e._v("创建的 "),a("code",[e._v("friendlyhello")]),e._v(" 镜像。我们将在此处使用该共享镜像。")]),e._v(" "),a("li",[e._v("确保您的镜像充当已部署的容器。运行以下命令，并填写 "),a("code",[e._v("username")]),e._v("、"),a("code",[e._v("repo")]),e._v(" 和 "),a("code",[e._v("tag")]),e._v(" 信息："),a("code",[e._v("docker run -p 80:80 username/repo:tag")]),e._v("，然后访问 "),a("code",[e._v("http://localhost/")]),e._v("。")]),e._v(" "),a("li",[e._v("就近获取"),a("a",{attrs:{href:"https://docs.docker-cn.com/get-started/part5/#persist-the-data",target:"_blank",rel:"noopener noreferrer"}},[e._v("第 5 部分中最终版本的 "),a("code",[e._v("docker-compose.yml")]),a("OutboundLink")],1),e._v("。")])]),e._v(" "),a("h2",{attrs:{id:"_2-简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-简介"}},[e._v("#")]),e._v(" 2. 简介")]),e._v(" "),a("p",[e._v("在整个教程中，您一直在编辑同一 Compose 文件。好消息是，和在您的机器上一样，该 Compose 文件在生产中正常运行。我们将在此完成用于运行 Docker 化应用程序的一些选项。")]),e._v(" "),a("h3",{attrs:{id:"_2-1-选择选项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-选择选项"}},[e._v("#")]),e._v(" 2.1. 选择选项")]),e._v(" "),a("h4",{attrs:{id:"_1-docker-enterprise"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-docker-enterprise"}},[e._v("#")]),e._v(" 1.Docker Enterprise")]),e._v(" "),a("p",[e._v("Docker 企业版的客户运行 Docker 引擎的稳定商业支持版本，并且作为附加内容，他们将获得我们的一流管理软件"),a("code",[e._v("Docker Datacenter")]),e._v("。您可以通过"),a("code",[e._v("UI")]),e._v("使用 Universal Control Plane 管理应用的各个方面，使用 Docker Trusted Registry 运行专用镜像库，与 "),a("code",[e._v("LDAP")]),e._v("提供商进行集成，使用 Docker Content Trust 签署生产镜像以及使用许多其他功能。")]),e._v(" "),a("p",[e._v("在您自己的服务器上安装 Docker 企业版和设置 "),a("code",[e._v("Docker Datacenter")]),e._v(" 本质上涉及两个步骤：")]),e._v(" "),a("ol",[a("li",[a("a",{attrs:{href:"https://store.docker.com/search?offering=enterprise&type=edition",target:"_blank",rel:"noopener noreferrer"}},[e._v("从 Docker Store 获取适用于您的服务器操作系统的 Docker 企业版"),a("OutboundLink")],1),e._v("。")]),e._v(" "),a("li",[e._v("按照"),a("a",{attrs:{href:"https://docs.docker-cn.com/datacenter/install/linux/",target:"_blank",rel:"noopener noreferrer"}},[e._v("在您自己的主机上安装 Datacenter 的说明"),a("OutboundLink")],1),e._v(" 执行操作。")])]),e._v(" "),a("blockquote",[a("p",[a("strong",[e._v("注意")]),e._v("：运行的是 Windows 容器？查看我们的 "),a("a",{attrs:{href:"https://docs.docker-cn.com/engine/installation/windows/docker-ee/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Windows Server 设置指南"),a("OutboundLink")],1),e._v("。")])]),e._v(" "),a("p",[e._v("完成所有设置并且 "),a("code",[e._v("Datacenter")]),e._v("已运行后，您可以"),a("a",{attrs:{href:"https://docs.docker-cn.com/datacenter/ucp/2.1/guides/user/services/",target:"_blank",rel:"noopener noreferrer"}},[e._v("直接从 UI 中部署 Compose 文件"),a("OutboundLink")],1),e._v("。")]),e._v(" "),a("p",[a("img",{attrs:{src:r(608),alt:"deploy-multi-service-app"}})]),e._v(" "),a("p",[e._v("然后，您会看到它进入运行状态，并且可以更改您选择的应用的任何方面，或者甚至可以编辑 Compose 文件本身。")]),e._v(" "),a("p",[a("img",{attrs:{src:r(609),alt:"/images/deploy-multi-service-app"}})]),e._v(" "),a("h4",{attrs:{id:"_2-docker-engine-社区"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-docker-engine-社区"}},[e._v("#")]),e._v(" 2.Docker Engine -社区")]),e._v(" "),a("ol",[a("li",[e._v("安装Docker Engine ---社区")])]),e._v(" "),a("p",[e._v("在您选择的平台上查找Docker Engine --- Community 的"),a("a",{attrs:{href:"https://docs.docker.com/install/#supported-platforms",target:"_blank",rel:"noopener noreferrer"}},[e._v("安装说明"),a("OutboundLink")],1),e._v("。")]),e._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[e._v("创建你的集群")])]),e._v(" "),a("p",[e._v("运行"),a("code",[e._v("docker swarm init")]),e._v("以在节点上创建一个群。")]),e._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[e._v("部署您的应用")])]),e._v(" "),a("p",[e._v("运行"),a("code",[e._v("docker stack deploy -c docker-compose.yml getstartedlab")]),e._v("以在云托管群上部署应用程序。")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("docker stack deploy -c docker-compose.yml getstartedlab\n\nCreating network getstartedlab_webnet\nCreating service getstartedlab_web\nCreating service getstartedlab_visualizer\nCreating service getstartedlab_redis\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br")])]),a("ol",{attrs:{start:"4"}},[a("li",[e._v("您的应用现在正在您的云提供商上运行。")])]),e._v(" "),a("h4",{attrs:{id:"运行一些swarm命令来验证部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行一些swarm命令来验证部署"}},[e._v("#")]),e._v(" 运行一些SWARM命令来验证部署")]),e._v(" "),a("p",[e._v("您可以使用swarm命令行来浏览和管理swarm。以下是一些现在应该看起来很熟悉的例子：")]),e._v(" "),a("ul",[a("li",[e._v("使用"),a("code",[e._v("docker node ls")]),e._v("到列表中的节点在群。")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[getstartedlab] ~ $ docker node ls\nID                            HOSTNAME                                      STATUS              AVAILABILITY        MANAGER STATUS\nn2bsny0r2b8fey6013kwnom3m *   ip-172-31-20-217.us-west-1.compute.internal   Ready               Active              Leader\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br")])]),a("ul",[a("li",[e._v("使用"),a("code",[e._v("docker service ls")]),e._v("列出的服务。")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[getstartedlab] ~/sandbox/getstart $ docker service ls\nID                  NAME                       MODE                REPLICAS            IMAGE                             PORTS\nioipby1vcxzm        getstartedlab_redis        replicated          0/1                 redis:latest                      *:6379->6379/tcp\nu5cxv7ppv5o0        getstartedlab_visualizer   replicated          0/1                 dockersamples/visualizer:stable   *:8080->8080/tcp\nvy7n2piyqrtr        getstartedlab_web          replicated          5/5                 sam/getstarted:part6    *:80->80/tcp\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br")])]),a("ul",[a("li",[e._v("使用"),a("code",[e._v("docker service ps <service>")]),e._v("查看任务的服务。")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[getstartedlab] ~/sandbox/getstart $ docker service ps vy7n2piyqrtr\nID                  NAME                  IMAGE                            NODE                                          DESIRED STATE       CURRENT STATE            ERROR               PORTS\nqrcd4a9lvjel        getstartedlab_web.1   sam/getstarted:part6   ip-172-31-20-217.us-west-1.compute.internal   Running             Running 20 seconds ago                       \nsknya8t4m51u        getstartedlab_web.2   sam/getstarted:part6   ip-172-31-20-217.us-west-1.compute.internal   Running             Running 17 seconds ago                       \nia730lfnrslg        getstartedlab_web.3   sam/getstarted:part6   ip-172-31-20-217.us-west-1.compute.internal   Running             Running 21 seconds ago                       \n1edaa97h9u4k        getstartedlab_web.4   sam/getstarted:part6   ip-172-31-20-217.us-west-1.compute.internal   Running             Running 21 seconds ago                       \nuh64ez6ahuew        getstartedlab_web.5   sam/getstarted:part6   ip-172-31-20-217.us-west-1.compute.internal   Running             Running 22 seconds ago        \n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br")])]),a("h4",{attrs:{id:"在云提供商机器上打开服务端口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在云提供商机器上打开服务端口"}},[e._v("#")]),e._v(" 在云提供商机器上打开服务端口")]),e._v(" "),a("p",[e._v("此时，您的应用程序将作为swarm部署在云提供程序服务器上，正如"),a("code",[e._v("docker")]),e._v("您刚刚运行的命令所证明的那样。但是，您仍需要在云服务器上打开端口，以便：")]),e._v(" "),a("ul",[a("li",[e._v("如果使用许多节点，则允许"),a("code",[e._v("redis")]),e._v("服务和"),a("code",[e._v("web")]),e._v("服务之间的通信")]),e._v(" "),a("li",[e._v("允许"),a("code",[e._v("web")]),e._v("任何工作节点上的服务的入站流量，以便可以从Web浏览器访问Hello World和Visualizer。")]),e._v(" "),a("li",[e._v("允许运行的服务器上的入站SSH流量"),a("code",[e._v("manager")]),e._v("（可能已在您的云提供商上设置）")])]),e._v(" "),a("p",[e._v("这些是您需要为每个服务公开的端口：")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("服务")]),e._v(" "),a("th",[e._v("类型")]),e._v(" "),a("th",[e._v("协议")]),e._v(" "),a("th",[e._v("港口")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[a("code",[e._v("web")])]),e._v(" "),a("td",[e._v("HTTP")]),e._v(" "),a("td",[e._v("TCP")]),e._v(" "),a("td",[e._v("80")])]),e._v(" "),a("tr",[a("td",[a("code",[e._v("visualizer")])]),e._v(" "),a("td",[e._v("HTTP")]),e._v(" "),a("td",[e._v("TCP")]),e._v(" "),a("td",[e._v("8080")])]),e._v(" "),a("tr",[a("td",[a("code",[e._v("redis")])]),e._v(" "),a("td",[e._v("TCP")]),e._v(" "),a("td",[e._v("TCP")]),e._v(" "),a("td",[e._v("6379")])])])]),e._v(" "),a("p",[e._v("执行此操作的方法因您的云提供商而异。")]),e._v(" "),a("p",[e._v("我们使用Amazon Web Services（"),a("code",[e._v("AWS")]),e._v("）作为示例。")]),e._v(" "),a("blockquote",[a("p",[a("code",[e._v("redis")]),e._v("服务如何保留数据呢？")]),e._v(" "),a("p",[e._v("要使"),a("code",[e._v("redis")]),e._v("服务正常运行，您需要"),a("code",[e._v("ssh")]),e._v("进入"),a("code",[e._v("manager")]),e._v("正在运行的云服务器，并"),a("code",[e._v("data/")]),e._v(" 在"),a("code",[e._v("/home/docker/")]),e._v("运行之前创建目录"),a("code",[e._v("docker stack deploy")]),e._v("。另一种选择是将数据路径更改"),a("code",[e._v("docker-stack.yml")]),e._v("为"),a("code",[e._v("manager")]),e._v("服务器上预先存在的路径。此示例不包括此步骤，因此"),a("code",[e._v("redis")]),e._v("示例输出中的服务未启动。")])]),e._v(" "),a("h3",{attrs:{id:"_2-2-迭代和清理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-迭代和清理"}},[e._v("#")]),e._v(" 2.2. 迭代和清理")]),e._v(" "),a("p",[e._v("从这里开始，您可以在本教程的前几部分中学到所有知识。")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("通过更改"),a("code",[e._v("docker-compose.yml")]),e._v("文件来扩展应用程序，并使用该"),a("code",[e._v("docker stack deploy")]),e._v("命令即时重新部署。")])]),e._v(" "),a("li",[a("p",[e._v("通过编辑代码，然后重建并推送新镜像来更改应用程序行为。（为此，请按照您之前用于"),a("a",{attrs:{href:"https://docs.docker.com/get-started/part2/#build-the-app",target:"_blank",rel:"noopener noreferrer"}},[e._v("构建应用程序"),a("OutboundLink")],1),e._v("并"),a("a",{attrs:{href:"https://docs.docker.com/get-started/part2/#publish-the-image",target:"_blank",rel:"noopener noreferrer"}},[e._v("发布图像"),a("OutboundLink")],1),e._v("的相同步骤）。")])]),e._v(" "),a("li",[a("p",[e._v("你可以清除应用栈"),a("code",[e._v("docker stack rm")]),e._v("。例如：")])])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("docker stack rm getstartedlab\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("与您在本地Docker机器"),a("code",[e._v("VM")]),e._v("上运行swarm的情况不同，无论您是否关闭本地主机，您的swarm及其上部署的任何应用程序都将继续在云服务器上运行。")]),e._v(" "),a("h4",{attrs:{id:"祝贺您"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#祝贺您"}},[e._v("#")]),e._v(" 祝贺您！")]),e._v(" "),a("p",[e._v("您已完成对整个 Docker 平台的完整技术栈、开发到部署浏览。")]),e._v(" "),a("p",[e._v("Docker 平台的内容远不止此处涵盖的内容，但您已了解容器、镜像、服务、swarm、技术栈、扩展、负载均衡、存储卷和布局约束的基本内容。")]),e._v(" "),a("p",[e._v("想要深入了解更多内容？以下是我们推荐的一些资源：")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://docs.docker-cn.com/samples/",target:"_blank",rel:"noopener noreferrer"}},[e._v("样板"),a("OutboundLink")],1),e._v("：我们的样板包含容器中运行的常用软件的多个示例，以及一些提供最佳实践的优秀实验室。")]),e._v(" "),a("li",[a("a",{attrs:{href:"https://docs.docker-cn.com/engine/userguide/",target:"_blank",rel:"noopener noreferrer"}},[e._v("用户指南"),a("OutboundLink")],1),e._v("：用户指南中提供了一些示例，它们更深入地说明了网络和存储。")]),e._v(" "),a("li",[a("a",{attrs:{href:"https://docs.docker-cn.com/engine/admin/",target:"_blank",rel:"noopener noreferrer"}},[e._v("管理指南"),a("OutboundLink")],1),e._v("：涵盖如何管理 Docker 化生产环境。")]),e._v(" "),a("li",[a("a",{attrs:{href:"https://training.docker.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("训练"),a("OutboundLink")],1),e._v("：官方 Docker 课程，提供了现场指导和虚拟教室环境。")]),e._v(" "),a("li",[a("a",{attrs:{href:"https://blog.docker.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("博客"),a("OutboundLink")],1),e._v("：涵盖 Docker 的最新内容。")])])])}),[],!1,null,null,null);t.default=s.exports}}]);