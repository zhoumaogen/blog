(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{610:function(s,a,t){s.exports=t.p+"assets/img/types-of-mounts-volume.f57d71c6.png"},611:function(s,a,t){s.exports=t.p+"assets/img/volumes-shared-storage.570c1aa1.png"},700:function(s,a,t){"use strict";t.r(a);var n=t(16),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"_4-3-使用volume数据挂载"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-使用volume数据挂载"}},[s._v("#")]),s._v(" 4.3 使用"),n("code",[s._v("volume")]),s._v("数据挂载")]),s._v(" "),n("p",[s._v("卷是保存Docker容器生成和使用的数据的首选机制。 虽然绑定挂载依赖于主机的目录结构，但卷完全由Docker管理。 卷绑定安装有几个优点：")]),s._v(" "),n("ul",[n("li",[s._v("与挂载相比，卷更易于备份或迁移。")]),s._v(" "),n("li",[s._v("您可以使用Docker CLI命令或Docker API管理卷。")]),s._v(" "),n("li",[s._v("卷适用于Linux和Windows容器。")]),s._v(" "),n("li",[s._v("可以在多个容器之间更安全地共享卷。")]),s._v(" "),n("li",[s._v("卷驱动程序允许您在远程主机或云提供程序上存储卷，加密卷的内容或添加其他功能。")]),s._v(" "),n("li",[s._v("新卷可以通过容器预先填充其内容。")])]),s._v(" "),n("p",[s._v("此外，卷通常是比容器的可写层中的持久数据更好的选择，因为卷不会增加使用它的容器的大小，并且卷的内容存在于给定容器的生命周期之外。")]),s._v(" "),n("p",[n("img",{attrs:{src:t(610),alt:"/images/types-of-mounts-volume.png"}})]),s._v(" "),n("p",[s._v("如果容器生成非持久状态数据，请考虑使用tmpfs挂载以避免将数据永久存储在任何位置，并通过避免写入容器的可写层来提高容器的性能。")]),s._v(" "),n("p",[s._v("卷使用rprivate绑定传播，并且卷不可配置绑定传播。")]),s._v(" "),n("h2",{attrs:{id:"_1-使用-v或者-mount参数"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-使用-v或者-mount参数"}},[s._v("#")]),s._v(" 1. 使用-v或者-mount参数")]),s._v(" "),n("p",[s._v("最初，"),n("code",[s._v("-v")]),s._v("或"),n("code",[s._v("--volume")]),s._v("标志用于独立容器，"),n("code",[s._v("-- mount")]),s._v("标志用于swarm服务。但是，从Docker 17.06开始，您还可以将"),n("code",[s._v("--mount")]),s._v("与独立容器一起使用。通常，"),n("code",[s._v("-- mount")]),s._v("更明确，更冗长。最大的区别是"),n("code",[s._v("-v")]),s._v("语法将所有选项组合在一个字段中，而"),n("code",[s._v("--mount")]),s._v("语法将它们分开。以下是每个标志的语法比较。")]),s._v(" "),n("blockquote",[n("p",[s._v("新用户应该尝试使用比"),n("code",[s._v("--volume")]),s._v("语法更简单的语法。")])]),s._v(" "),n("p",[s._v("如果需要指定卷驱动程序选项，则必须使用"),n("code",[s._v("--mount")]),s._v("。")]),s._v(" "),n("ul",[n("li",[n("p",[n("code",[s._v("-v")]),s._v("或"),n("code",[s._v("--volume")]),s._v("：由三个字段组成，用冒号字符（"),n("code",[s._v(":")]),s._v(")分隔。字段必须按正确的顺序排列，并且每个字段的含义不是很明显。")]),s._v(" "),n("ul",[n("li",[s._v("对于命名卷，第一个字段是卷的名称，并且在给定主机上是唯一的。对于匿名卷，省略第一个字段。")]),s._v(" "),n("li",[s._v("第二个字段是文件或目录在容器中安装的路径。")]),s._v(" "),n("li",[s._v("第三个字段是可选的，是逗号分隔的选项列表，例如"),n("code",[s._v("ro")]),s._v("。这些选项将在下面讨论。")])])]),s._v(" "),n("li",[n("p",[n("code",[s._v("--mount")]),s._v("：由多个键值对组成，用逗号分隔，每个键值由"),n("code",[s._v("<key> = <value>")]),s._v("元组组成。 "),n("code",[s._v("--mount")]),s._v("语法比"),n("code",[s._v("-v")]),s._v("或"),n("code",[s._v("--volume")]),s._v("更冗长，但键的顺序并不重要，并且标志的值更容易理解。")]),s._v(" "),n("ul",[n("li",[n("code",[s._v("mount")]),s._v("的类型，可以是"),n("code",[s._v("bind")]),s._v("，"),n("code",[s._v("volume")]),s._v("或"),n("code",[s._v("tmpfs")]),s._v("。本主题讨论卷，因此类型始终是卷。")]),s._v(" "),n("li",[n("code",[s._v("mount")]),s._v("的"),n("code",[s._v("source")]),s._v("。对于命名卷，这是卷的名称。对于匿名卷，省略此字段。可以指定为"),n("code",[s._v("source")]),s._v("或"),n("code",[s._v("src")]),s._v("。")]),s._v(" "),n("li",[s._v("目标将其值作为容器中安装文件或目录的路径。可以指定为"),n("code",[s._v("destination")]),s._v("，"),n("code",[s._v("dst")]),s._v("或"),n("code",[s._v("target")]),s._v("。")]),s._v(" "),n("li",[n("code",[s._v("readonly")]),s._v("选项（如果存在）使绑定装入以只读方式装入容器中。")]),s._v(" "),n("li",[n("code",[s._v("volume-opt")]),s._v("选项可以多次指定，它采用由选项名称及其值组成的键值对。")])])])]),s._v(" "),n("blockquote",[n("p",[s._v("从外部CSV解析器中转义值\n如果您的卷驱动程序接受以逗号分隔的列表作为选项，则必须从外部CSV解析器中转义该值。要转义音量选择，请用双引号（“）将其括起来，并用单引号（'）括住整个mount参数。\n例如，本地驱动程序将挂载选项作为o参数中的逗号分隔列表接受。此示例显示了转义列表的正确方法。")])]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" create "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n     --mount "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'type=volume,src=<VOLUME-NAME>,dst=<CONTAINER-PATH>,volume-driver=local,volume-opt=type=nfs,volume-opt=device=<nfs-server>:<nfs-path>,\"volume-opt=o=addr=<nfs-address>,vers=4,soft,timeo=180,bg,tcp,rw\"'")]),s._v("\n    --name myservice "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("IMAGE"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("以下示例在可能的情况下显示"),n("code",[s._v("--mount")]),s._v("和"),n("code",[s._v("-v")]),s._v("语法，并首先显示"),n("code",[s._v("--mount")]),s._v("。")]),s._v(" "),n("p",[n("strong",[s._v("-v和--mount行为之间的差异")])]),s._v(" "),n("p",[s._v("与绑定挂载相反，卷的所有选项都可用于"),n("code",[s._v("--mount")]),s._v("和"),n("code",[s._v("-v")]),s._v("标志。")]),s._v(" "),n("p",[s._v("将卷与服务一起使用时，仅支持"),n("code",[s._v("--mount")]),s._v("。")]),s._v(" "),n("h2",{attrs:{id:"_2-创建和管理volume"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-创建和管理volume"}},[s._v("#")]),s._v(" 2. 创建和管理volume")]),s._v(" "),n("p",[s._v("与挂载不同，您可以创建和管理任何容器范围之外的卷。")]),s._v(" "),n("p",[s._v("创建卷:")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" volume create my-vol\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("查看所有卷:")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" volume "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("               my-vol\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("查看卷详细信息:")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" volume inspect my-vol\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Driver"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"local"')]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Labels"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Mountpoint"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/lib/docker/volumes/my-vol/_data"')]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Name"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-vol"')]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Options"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Scope"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"local"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("删除卷:")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" volume "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" my-vol\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"_3-启动具有卷的容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-启动具有卷的容器"}},[s._v("#")]),s._v(" 3. 启动具有卷的容器")]),s._v(" "),n("p",[s._v("如果启动具有尚不存在的卷的容器，Docker会为您创建卷。 以下示例将卷"),n("code",[s._v("myvol2")]),s._v("安装到容器中的"),n("code",[s._v("/ app /")]),s._v("中。")]),s._v(" "),n("p",[s._v("下面的"),n("code",[s._v("-v")]),s._v("和"),n("code",[s._v("--mount")]),s._v("示例产生相同的结果。 除非在运行第一个容器和"),n("code",[s._v("myvol2")]),s._v("卷之后删除它，否则不能同时运行它们。")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --mount")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --name devtest "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --mount "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("source")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("myvol2,target"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/app "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  nginx:latest\n  \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -v")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --name devtest "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -v myvol2:/app "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  nginx:latest\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("使用"),n("code",[s._v("docker inspect devtest")]),s._v("验证卷是否已创建并正确安装。 寻找"),n("code",[s._v("Mounts")]),s._v("部分：")]),s._v(" "),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Mounts"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Type"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"volume"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Name"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"myvol2"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Source"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/lib/docker/volumes/myvol2/_data"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Destination"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/app"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Driver"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"local"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Mode"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"RW"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Propagation"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[s._v("这表明"),n("code",[s._v("mount")]),s._v("是一个卷，它显示正确的源和目标，并且"),n("code",[s._v("mount")]),s._v("是可读写的。")]),s._v(" "),n("p",[s._v("停止容器并移除卷。 注意删除卷是一个单独的步骤。")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container stop devtest\n\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" devtest\n\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" volume "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" myvol2\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h3",{attrs:{id:"_3-1-使用volumes开启一个服务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-使用volumes开启一个服务"}},[s._v("#")]),s._v(" 3.1. 使用volumes开启一个服务")]),s._v(" "),n("p",[s._v("启动服务并定义卷时，每个服务容器都使用自己的本地卷。 如果使用"),n("code",[s._v("local")]),s._v("卷驱动程序，则所有容器都不能共享此数据，但某些卷驱动程序确实支持共享存储。 Docker for AWS和Docker for Azure都支持使用Cloudstor插件的持久存储。")]),s._v(" "),n("p",[s._v("以下示例启动具有四个副本的"),n("code",[s._v("nginx")]),s._v("服务，每个副本使用名为"),n("code",[s._v("myvol2")]),s._v("的本地卷。")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" create -d "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --replicas"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --name devtest-service "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --mount "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("source")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("myvol2,target"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/app "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  nginx:latest\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("使用"),n("code",[s._v("docker service ps devtest-service")]),s._v("验证服务是否正在运行：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" devtest-service\n\nID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE            ERROR               PORTS\n4d7oz1j85wwn        devtest-service.1   nginx:latest        moby                Running             Running "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" seconds ago\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("删除服务，停止其所有任务：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" devtest-service\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("删除该服务不会删除该服务创建的任何卷。 去除卷是一个单独的步骤。")]),s._v(" "),n("p",[n("strong",[s._v("服务的语法差异")]),s._v(" "),n("code",[s._v("docker service create")]),s._v("命令不支持"),n("code",[s._v("-v")]),s._v("或"),n("code",[s._v("--volume")]),s._v("标志。 将卷安装到服务的容器中时，必须使用"),n("code",[s._v("--mount")]),s._v("标志。")]),s._v(" "),n("h3",{attrs:{id:"_3-2-使用容器填充volume"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-使用容器填充volume"}},[s._v("#")]),s._v(" 3.2. 使用容器填充volume")]),s._v(" "),n("p",[s._v("如果启动一个创建新卷的容器（如上所述），并且容器在要挂载的目录中有文件或目录（例如"),n("code",[s._v("/ app /")]),s._v(" ），则将目录的内容复制到卷中。 然后容器安装并使用该卷，而使用该卷的其他容器也可以访问预先填充的内容。")]),s._v(" "),n("p",[s._v("为了说明这一点，此示例启动一个"),n("code",[s._v("nginx")]),s._v("容器，并使用容器的"),n("code",[s._v("/ usr / share / nginx / html")]),s._v("目录的内容填充新卷"),n("code",[s._v("nginx-vol")]),s._v("，这是Nginx存储其默认HTML内容的位置。")]),s._v(" "),n("p",[n("code",[s._v("--mount")]),s._v("和"),n("code",[s._v("-v")]),s._v("示例具有相同的最终结果。")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --mount")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginxtest "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --mount "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("source")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx-vol,destination"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/share/nginx/html "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  nginx:latest\n  \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -v")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginxtest "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -v nginx-vol:/usr/share/nginx/html "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  nginx:latest\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("运行这些示例之一后，运行以下命令以清理容器和卷。 注意删除卷是一个单独的步骤。")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container stop nginxtest\n\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" nginxtest\n\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" volume "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" nginx-vol\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h2",{attrs:{id:"_4-使用只读volume"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-使用只读volume"}},[s._v("#")]),s._v(" 4. 使用只读volume")]),s._v(" "),n("p",[s._v("对于某些开发应用程序，容器需要写入绑定装入，以便将更改传播回Docker主机。 在其他时候，容器只需要对数据的读访问权。 请记住，多个容器可以安装相同的卷，并且可以为其中一些容器以读写方式挂载，同时为其他容器以只读方式挂载。")]),s._v(" "),n("p",[s._v("此示例修改上面的一个，但通过在容器中的挂载点之后将"),n("code",[s._v("ro")]),s._v("添加到（默认情况下为空）选项列表，将目录挂载为只读卷。 如果存在多个选项，请用逗号分隔。")]),s._v(" "),n("p",[n("code",[s._v("--mount")]),s._v("和"),n("code",[s._v("-v")]),s._v("示例具有相同的结果。")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --mount")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginxtest "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --mount "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("source")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx-vol,destination"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/share/nginx/html,readonly "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  nginx:latest\n  \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -v")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginxtest "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -v nginx-vol:/usr/share/nginx/html:ro "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  nginx:latest\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("使用"),n("code",[s._v("docker inspect nginxtest")]),s._v("验证是否正确创建了只读挂载。 寻找"),n("code",[s._v("Mounts")]),s._v("部分：")]),s._v(" "),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Mounts"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Type"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"volume"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Name"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx-vol"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Source"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/lib/docker/volumes/nginx-vol/_data"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Destination"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/share/nginx/html"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Driver"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"local"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Mode"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"RW"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"Propagation"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[s._v("停止并移除容器，然后移除卷。 移除卷是一个单独的步骤。")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container stop nginxtest\n\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" container "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" nginxtest\n\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" volume "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" nginx-vol\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h2",{attrs:{id:"_5-在机器之间共享数据"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-在机器之间共享数据"}},[s._v("#")]),s._v(" 5. 在机器之间共享数据")]),s._v(" "),n("p",[s._v("构建容错应用程序时，可能需要配置同一服务的多个副本才能访问相同的文件。")]),s._v(" "),n("p",[n("img",{attrs:{src:t(611),alt:"/images/volumes-shared-storage.png"}})]),s._v(" "),n("p",[s._v("在开发应用程序时，有几种方法可以实现此目的。 一种是为应用程序添加逻辑，以将文件存储在Amazon S3等云对象存储系统上。 另一种方法是使用支持将文件写入NFS或Amazon S3等外部存储系统的驱动程序创建卷。")]),s._v(" "),n("p",[s._v("卷驱动程序允许您从应用程序逻辑中抽象底层存储系统。 例如，如果您的服务使用具有NFS驱动程序的卷，则可以更新服务以使用其他驱动程序，例如在云中存储数据，而无需更改应用程序逻辑。")]),s._v(" "),n("h2",{attrs:{id:"_6-使用volume驱动程序"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-使用volume驱动程序"}},[s._v("#")]),s._v(" 6. 使用volume驱动程序")]),s._v(" "),n("p",[s._v("使用"),n("code",[s._v("docker volume create")]),s._v("创建卷时，或者启动使用尚未创建的卷的容器时，可以指定卷驱动程序。 以下示例使用"),n("code",[s._v("vieux / sshfs")]),s._v("卷驱动程序，首先在创建独立卷时，然后在启动创建新卷的容器时使用。")]),s._v(" "),n("h2",{attrs:{id:"_7-初始设置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-初始设置"}},[s._v("#")]),s._v(" 7. 初始设置")]),s._v(" "),n("p",[s._v("此示例假定您有两个节点，第一个节点是Docker主机，可以使用SSH连接到第二个节点。")]),s._v(" "),n("p",[s._v("在Docker主机上，安装"),n("code",[s._v("vieux / sshfs")]),s._v("插件：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" plugin "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --grant-all-permissions vieux/sshfs\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"_7-1-使用卷驱动程序创建卷"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-使用卷驱动程序创建卷"}},[s._v("#")]),s._v(" 7.1. 使用卷驱动程序创建卷")]),s._v(" "),n("p",[s._v("此示例指定SSH密码，但如果两台主机配置了共享密钥，则可以省略密码。 每个卷驱动程序可以具有零个或多个可配置选项，每个选项都使用"),n("code",[s._v("-o")]),s._v("标志指定。")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" volume create --driver vieux/sshfs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -o "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sshcmd")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("test@node2:/home/test "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -o "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("password")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("testpassword "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  sshvolume\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h3",{attrs:{id:"_7-2-创建一个创建nfs卷的服务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-创建一个创建nfs卷的服务"}},[s._v("#")]),s._v(" 7.2. 创建一个创建NFS卷的服务")]),s._v(" "),n("p",[s._v("此示例显示如何在创建服务时创建NFS卷。 此示例使用"),n("code",[s._v("10.0.0.10")]),s._v("作为NFS服务器，使用"),n("code",[s._v("/ var / docker-nfs")]),s._v("作为NFS服务器上的导出目录。 请注意，指定的卷驱动程序是"),n("code",[s._v("local")]),s._v("的。")]),s._v(" "),n("p",[n("strong",[s._v("NFSV3")])]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" create -d "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --name nfs-service "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --mount "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'type=volume,source=nfsvolume,target=/app,volume-driver=local,volume-opt=type=nfs,volume-opt=device=:/var/docker-nfs,volume-opt=o=addr=10.0.0.10'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  nginx:latest\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[n("strong",[s._v("NFSV4")])]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" create -d "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --name nfs-service "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --mount "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'type=volume,source=nfsvolume,target=/app,volume-driver=local,volume-opt=type=nfs,volume-opt=device=:/,\"volume-opt=o=10.0.0.10,rw,nfsvers=4,async\"'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    nginx:latest`\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h2",{attrs:{id:"_8-备份-还原或迁移数据卷"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-备份-还原或迁移数据卷"}},[s._v("#")]),s._v(" 8. 备份，还原或迁移数据卷")]),s._v(" "),n("p",[s._v("卷对备份，还原和迁移很有用。 使用--volumes-from标志创建一个安装该卷的新容器。")]),s._v(" "),n("h3",{attrs:{id:"_8-1-备份容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-备份容器"}},[s._v("#")]),s._v(" 8.1. 备份容器")]),s._v(" "),n("p",[s._v("例如，在下一个命令中，我们：")]),s._v(" "),n("ul",[n("li",[s._v("启动新容器并从dbstore容器装入卷")]),s._v(" "),n("li",[s._v("将本地主机目录挂载为/ backup")]),s._v(" "),n("li",[s._v("将包含dbdata卷内容的命令传递到/ backup目录中的backup.tar文件。")])]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run --rm --volumes-from dbstore -v "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(":/backup ubuntu "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" cvf /backup/backup.tar /dbdata\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("当命令完成并且容器停止时，我们将留下dbdata卷的备份。")]),s._v(" "),n("h3",{attrs:{id:"_8-2-从备份还原容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-从备份还原容器"}},[s._v("#")]),s._v(" 8.2. 从备份还原容器")]),s._v(" "),n("p",[s._v("使用刚刚创建的备份，您可以将其还原到同一容器或您在其他位置创建的另一个容器。")]),s._v(" "),n("p",[s._v("例如，创建一个名为"),n("code",[s._v("dbstore2")]),s._v("的新容器：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -v /dbdata --name dbstore2 ubuntu /bin/bash\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("然后解压缩新容器的数据卷中的备份文件：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run --rm --volumes-from dbstore2 -v "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(":/backup ubuntu "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v(" -c "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cd /dbdata && tar xvf /backup/backup.tar --strip 1"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("您可以使用上述技术使用首选工具自动执行备份，迁移和还原测试。")]),s._v(" "),n("h2",{attrs:{id:"_9-删除卷"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_9-删除卷"}},[s._v("#")]),s._v(" 9. 删除卷")]),s._v(" "),n("p",[s._v("删除容器后，Docker数据卷仍然存在。 要考虑两种类型的卷：")]),s._v(" "),n("p",[s._v("命名卷具有来自容器外部的特定源，例如awesome：/ bar。\n匿名卷没有特定的源，因此在删除容器时，指示Docker Engine守护程序删除它们。")]),s._v(" "),n("h3",{attrs:{id:"_9-1-删除匿名卷"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_9-1-删除匿名卷"}},[s._v("#")]),s._v(" 9.1. 删除匿名卷")]),s._v(" "),n("p",[s._v("要自动删除匿名卷，请使用--rm选项。 例如，此命令创建匿名/ foo卷。 移除容器后，Docker Engine会删除/ foo卷但不会删除令人敬畏的卷。")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run --rm -v / foo -v awesome：/ bar busybox "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"_9-2-删除所有卷"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_9-2-删除所有卷"}},[s._v("#")]),s._v(" 9.2. 删除所有卷")]),s._v(" "),n("p",[s._v("要删除所有未使用的卷并释放空间：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" volume prune\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);