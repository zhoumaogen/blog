(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{706:function(s,n,e){"use strict";e.r(n);var a=e(16),t=Object(a.a)({},(function(){var s=this,n=s.$createElement,e=s._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"_2-安装与配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装与配置"}},[s._v("#")]),s._v(" 2. 安装与配置")]),s._v(" "),e("h3",{attrs:{id:"_2-1-安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-安装"}},[s._v("#")]),s._v(" 2.1. 安装")]),s._v(" "),e("ol",[e("li",[s._v("CentOS的yum安装：")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("$ yum install keepalived\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ol",{attrs:{start:"2"}},[e("li",[s._v("基于Linux的源码安装：")])]),s._v(" "),e("p",[e("a",{attrs:{href:"https://www.keepalived.org/download.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("keepalived下载"),e("OutboundLink")],1)]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 依赖库：gcc、openssl-devel、libnl、libnl-devel、libnfnetlink-devel")]),s._v("\n\n$ ./configure\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"_2-2-默认配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-默认配置"}},[s._v("#")]),s._v(" 2.2. 默认配置")]),s._v(" "),e("p",[s._v("安装完成后，在"),e("code",[s._v("/etc/keepalived")]),s._v("文件夹中，"),e("code",[s._v("keepalived.conf")]),s._v("是"),e("code",[s._v("keepalived")]),s._v("自动生成的默认配置文件，文件配置项说明如下：")]),s._v(" "),e("div",{staticClass:"language-conf line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('! Configuration File for keepalived\n\nglobal_defs {    # 全局参数定义\n   notification_email {    # 定义通告邮件用户地址\n     acassen@firewall.loc    #接收邮件地址\n     failover@firewall.loc\n     sysadmin@firewall.loc\n   }\n   notification_email_from Alexandre.Cassen@firewall.loc    # 定义发送邮件地址\n   smtp_server 192.168.200.1  #邮件服务器\n   smtp_connect_timeout 30    #连接超时\n   router_id LVS_DEVEL    #当前路由设备ID\n}\n\nvrrp_script check_nginx {   # 脚本定义\n    script "/etc/keepalived/check_keepalived.sh"   # 脚本位置\n    interval 2  # 执行频率\n    weight -5 # 根据脚本返回值调整priority\n}\n\nvrrp_instance VI_1 {    # 定义VRRP实例\n    state MASTER    # 状态参数：MASTER/BACKUP(主/备)\n    interface ens33    # 虚拟IP放置的的网卡接口\n    virtual_router_id 51    #设置虚拟路由集群ID，同一个集群内的ID要一致\n    priority 100    # 优先级设置，数值越大优先级越高\n    advert_int 1    # 主备通讯时间间隔\n    nopreempt    # 非抢占式\n    authentication {    # 验证相关，同一组服务器配置需相同\n        auth_type PASS    #PASS|AH\n        auth_pass 1111\n    }\n    virtual_ipaddress {  # 虚拟IP地址\n        192.168.200.16\n        192.168.200.17\n        192.168.200.18\n    }\n    track_script {\n        check_nginx\n    }\n}\n\nvirtual_server 192.168.1.201 80 { #虚拟服务器配置块\n\t  delay_loop 3 #轮询健康检查时间间隔\n\t  lb_algo rr #负载均衡算法，rr,wrr,lc.wlc.lblc,sh,dh,默认wlc\n    lb_kind DR #负载均衡模式，NAT,DR,TUN\n\t  protocol TCP #协议\n\t  sorry_server 127.0.0.1 8001 # 宕机反馈页，real_server宕机后跳转\n\t  real_server 192.168.1.107 80 { #真实服务器配置块\n   \t  weight 1 #权重\n   \t  HTTP_GET { #健康检测方式HTTP_GET,SSL_GET,TCP_CHECK,SMTP_CHECK,MISC_CHECK\n   \t    \turl {\n   \t    \t\tpath / #请求主页信息，可以自定义一个页面，专用做健康检测\n   \t    \t\tstatus_code 200\t#判断健康反馈码\n   \t    \t}\n   \t    \tconnect_timeout 3 #检测超时时长\n   \t    \tnb_get_retry 3 #重试次数\n   \t    \tdelay_before_retry 3 #延时时间，三秒检测一次，失败后，延时三秒后再次检测，失败三次后，判断为下线状态\n   \t\t}\n   \t}\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br")])]),e("h3",{attrs:{id:"_2-3-抢占式与非抢占式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-抢占式与非抢占式"}},[s._v("#")]),s._v(" 2.3. 抢占式与非抢占式")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("抢占式："),e("code",[s._v("MASTER")]),s._v("从故障中恢复后，会将"),e("code",[s._v("VIP")]),s._v("从"),e("code",[s._v("BACKUP")]),s._v("节点中抢占过来。"),e("code",[s._v("keepalived")]),s._v("组中服务器将状态"),e("code",[s._v("state")]),s._v("分别配置为"),e("code",[s._v("MASTER")]),s._v("、"),e("code",[s._v("BACKUP")]),s._v("，但"),e("code",[s._v("keepalived")]),s._v("启动后，优先级"),e("code",[s._v("priority")]),s._v("配置高的先成为主服务器，拥有"),e("code",[s._v("VIP")]),s._v("。")])]),s._v(" "),e("li",[e("p",[s._v("非抢占式：之前的"),e("code",[s._v("MASTER")]),s._v("从故障中恢复后，不抢占由"),e("code",[s._v("BACKUP")]),s._v("升级为新的"),e("code",[s._v("MASTER")]),s._v("后的"),e("code",[s._v("VIP")]),s._v("。要设置非抢占式，除了增加"),e("code",[s._v("nopreempt")]),s._v("选项外，"),e("code",[s._v("keepalived")]),s._v("组中服务器要将状态"),e("code",[s._v("state")]),s._v("都配置为"),e("code",[s._v("BACKUP")]),s._v("，先启动"),e("code",[s._v("keepalived")]),s._v("的服务器最先成为主服务器，拥有"),e("code",[s._v("VIP")]),s._v("，与优先级"),e("code",[s._v("priority")]),s._v("配置无关。")])])])])}),[],!1,null,null,null);n.default=t.exports}}]);