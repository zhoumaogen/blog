(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{497:function(s,t,a){s.exports=a.p+"assets/img/190610-1.d66f4928.png"},498:function(s,t,a){s.exports=a.p+"assets/img/190610-2.d002928b.png"},589:function(s,t,a){"use strict";a.r(t);var n=a(6),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"title"}),n("p",[s._v("反向代理一词是相对于正向代理而言的。正向代理是一个位于客户端和原始服务器(origin server)之间的服务器，为了从原始服务器取得内容，客户端向代理发送一个请求并指定目标(原始服务器)，然后代理向原始服务器转交请求并将获得的内容返回给客户端。")])]),s._v(" "),n("h2",{attrs:{id:"_1-概念"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-概念"}},[s._v("#")]),s._v(" 1 概念")]),s._v(" "),n("p",[s._v("反向代理一词是相对于正向代理而言的。正向代理是一个位于客户端和原始服务器(origin server)之间的服务器，为了从原始服务器取得内容，客户端向代理发送一个请求并指定目标(原始服务器)，然后代理向原始服务器转交请求并将获得的内容返回给客户端，如图。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(497),alt:"正向代理"}})]),s._v(" "),n("p",[s._v("而反向代理是指以代理服务器来接受internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给internet上请求连接的客户端，此时代理服务器对外就表现为一个服务器，如图。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(498),alt:"反向代理"}})]),s._v(" "),n("p",[n("code",[s._v("Nginx")]),s._v("通过对其"),n("code",[s._v("http/server/location")]),s._v("模块配置实现反向代理，进而通过"),n("code",[s._v("upstream")]),s._v("模块配置实现负载均衡。")]),s._v(" "),n("h2",{attrs:{id:"_2-作用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-作用"}},[s._v("#")]),s._v(" 2 作用")]),s._v(" "),n("ul",[n("li",[s._v("保证内网的安全，可以使用反向代理提供WAF功能，阻止Web攻击，大型网站，通常将反向代理作为公网访问地址，Web服务器是内网。")]),s._v(" "),n("li",[s._v("负载均衡，通过反向代理服务器来优化网站的负载")])]),s._v(" "),n("h2",{attrs:{id:"_3-在linux中用nginx实现反向代理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-在linux中用nginx实现反向代理"}},[s._v("#")]),s._v(" 3 在Linux中用Nginx实现反向代理")]),s._v(" "),n("h3",{attrs:{id:"_3-1-环境准备"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-环境准备"}},[s._v("#")]),s._v(" 3.1 环境准备")]),s._v(" "),n("p",[s._v("操作系统：CentOS-7(x64)")]),s._v(" "),n("h3",{attrs:{id:"_3-2-安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-安装"}},[s._v("#")]),s._v(" 3.2 安装")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("yum "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nginx\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"_3-3-配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-配置"}},[s._v("#")]),s._v(" 3.3 配置")]),s._v(" "),n("p",[s._v("进入"),n("code",[s._v("/etc/nginx")]),s._v("文件夹，编辑"),n("code",[s._v("nginx.conf")]),s._v("文件：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("http "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    log_format  main  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),s._v(" - "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_user")]),s._v(" ["),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$time_local")]),s._v('] "'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request")]),s._v("\" '")]),s._v("\n                      "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$status")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$body_bytes_sent")]),s._v(' "'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_referer")]),s._v("\" '")]),s._v("\n                      "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\""),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_user_agent")]),s._v('" "'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_x_forwarded_for")]),s._v("\"'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    access_log  /var/log/nginx/access.log  main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    sendfile            on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    tcp_nopush          on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    tcp_nodelay         on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    keepalive_timeout   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    types_hash_max_size "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    include             /etc/nginx/mime.types"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    default_type        application/octet-stream"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Load modular configuration files from the /etc/nginx/conf.d directory.")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# See http://nginx.org/en/docs/ngx_core_module.html#include")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# for more information.")]),s._v("\n    include /etc/nginx/conf.d/*.conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 虚拟主机配置，一个http中可以配置多个server")]),s._v("\n    server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        listen       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" default_server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        listen       "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("::"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":80 default_server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        server_name  server.nginx.com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定ip地址或者域名，多个配置之间用空格分隔")]),s._v("\n        root         /usr/share/nginx/html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 表示整个server虚拟主机内的根目录")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Load configuration files for the default server block.")]),s._v("\n        include /etc/nginx/default.d/*.conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        location / "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        error_page "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("404")]),s._v(" /40html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            location "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /40x.html "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        error_page "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("502")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("504")]),s._v(" /50x.html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            location "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /50x.html "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br")])]),n("h3",{attrs:{id:"_3-4-运行"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-运行"}},[s._v("#")]),s._v(" 3.4 运行")]),s._v(" "),n("p",[s._v("控制台输入"),n("code",[s._v("nginx")]),s._v("命令运行nginx服务，进入"),n("code",[s._v("http://server.nginx.com")]),s._v("可访问"),n("code",[s._v("nginx")]),s._v("默认主页，也就是"),n("code",[s._v("server")]),s._v("中"),n("code",[s._v("root")]),s._v("的配置项"),n("code",[s._v("/usr/share/nginx/html")]),s._v("对应的内容")]),s._v(" "),n("h3",{attrs:{id:"_3-5-配置一个tomcat服务的反向代理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-配置一个tomcat服务的反向代理"}},[s._v("#")]),s._v(" 3.5 配置一个tomcat服务的反向代理")]),s._v(" "),n("p",[s._v("在"),n("code",[s._v("http")]),s._v("模块中加入"),n("code",[s._v("upstream")]),s._v("模块并配置"),n("code",[s._v("tomcat")]),s._v("服务的地址：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("http "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  upstream tomcat_server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      server "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".47.128:8080"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tomcat服务器地址")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("在"),n("code",[s._v("http")]),s._v("模块的"),n("code",[s._v("location")]),s._v("子模块配置"),n("code",[s._v("proxy_pass")]),s._v("属性，指定"),n("code",[s._v("upstream")]),s._v("：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("http "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  location / "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    proxy_pass http://tomcat_server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此tomcat_server与上文中的tomcat_server对应")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("控制台输入"),n("code",[s._v("nginx -s reload")]),s._v("重启"),n("code",[s._v("nginx")]),s._v("服务后，浏览器进入"),n("code",[s._v("server.nginx.com")]),s._v("将会跳转到"),n("code",[s._v("192.168.47.128:8080")]),s._v("所对应的"),n("code",[s._v("tomcat")]),s._v("服务。")]),s._v(" "),n("h2",{attrs:{id:"查看更多"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看更多"}},[s._v("#")]),s._v(" 查看更多")]),s._v(" "),n("p",[n("RouterLink",{attrs:{to:"/blogs/operations/2019/0610-nginx-balance.html"}},[s._v("预研：Nginx实现负载均衡")])],1)])}),[],!1,null,null,null);t.default=e.exports}}]);